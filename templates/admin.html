{% extends "base.html" %}

{% block title %}Painel Admin - Chapada M√≠stica{% endblock %}

{% block content %}
<section class="page-hero">
    <div class="container">
        <h1 class="page-title">Painel Administrativo</h1>
        <p class="page-subtitle">Gerencie reservas, depoimentos e galeria</p>
    </div>
</section>

<section class="admin-section">
    <div class="container">
        <div class="admin-tabs">
            <button class="tab-btn active" data-tab="bookings">Reservas ({{ bookings|length }})</button>
            <button class="tab-btn" data-tab="testimonials">Depoimentos ({{ testimonials|length }})</button>
            <button class="tab-btn" data-tab="videos">Experi√™ncias Reais ({{ videos|length }})</button>
            <button class="tab-btn" data-tab="gallery">Galeria ({{ gallery|length }})</button>
        </div>

        <!-- Bookings Tab -->
        <div class="tab-content active" id="bookings">
            <h2>Solicita√ß√µes de Reserva</h2>
            {% if bookings %}
            <div class="table-container">
                <table class="admin-table">
                    <thead>
                        <tr>
                            <th>Nome</th>
                            <th>Email</th>
                            <th>Telefone</th>
                            <th>Data</th>
                            <th>Pessoas</th>
                            <th>Mensagem</th>
                            <th>Recebido em</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for booking in bookings|reverse %}
                        <tr>
                            <td>{{ booking.name }}</td>
                            <td>{{ booking.email }}</td>
                            <td>{{ booking.phone }}</td>
                            <td>{{ booking.date }}</td>
                            <td>{{ booking.people }}</td>
                            <td>{{ booking.message or '-' }}</td>
                            <td>{{ booking.timestamp[:10] }}</td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
            {% else %}
            <p class="empty-message">Nenhuma reserva ainda.</p>
            {% endif %}
        </div>

        <!-- Testimonials Tab -->
        <div class="tab-content" id="testimonials">
            <h2>Adicionar Depoimento</h2>
            <form method="POST" action="{{ url_for('add_testimonial') }}" class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Avalia√ß√£o</label>
                        <select name="rating" required>
                            <option value="5">5 Estrelas</option>
                            <option value="4">4 Estrelas</option>
                            <option value="3">3 Estrelas</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Depoimento</label>
                    <textarea name="text" rows="3" required></textarea>
                </div>
                <button type="submit" class="btn btn-primary">Adicionar Depoimento</button>
            </form>

            <h3 style="margin-top: 3rem;">Depoimentos Existentes</h3>
            {% if testimonials %}
            <div class="testimonials-list">
                {% for t in testimonials|reverse %}
                <div class="testimonial-item">
                    <div class="testimonial-header">
                        <strong>{{ t.name }}</strong>
                        <span>{{ '‚òÖ' * t.rating }}</span>
                    </div>
                    <p>{{ t.text }}</p>
                    <small>{{ t.date }}</small>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-message">Nenhum depoimento ainda.</p>
            {% endif %}
        </div>

        <!-- Videos Tab (Experi√™ncias Reais) -->
        <div class="tab-content" id="videos">
            <h2>Adicionar V√≠deo Depoimento</h2>
            <form method="POST" action="{{ url_for('add_video') }}" enctype="multipart/form-data" class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>Avalia√ß√£o</label>
                        <select name="rating" required>
                            <option value="5">5 Estrelas</option>
                            <option value="4">4 Estrelas</option>
                            <option value="3">3 Estrelas</option>
                        </select>
                    </div>
                </div>
                
                <div class="upload-method-selector">
                    <div class="method-tabs">
                        <button type="button" class="method-tab-video active" data-method="video-upload">
                            üì§ Upload de V√≠deo
                        </button>
                        <button type="button" class="method-tab-video" data-method="video-url">
                            üîó YouTube / Vimeo
                        </button>
                    </div>
                </div>
                
                <!-- Upload de v√≠deo -->
                <div class="upload-method-video active" id="video-upload-method">
                    <div class="form-group">
                        <label>Fazer Upload do V√≠deo</label>
                        <div class="file-upload-area video-upload">
                            <input type="file" id="video-file-input" name="video_file" accept="video/*">
                            <div class="file-upload-label">
                                <span class="upload-icon">üé•</span>
                                <span class="upload-text">Clique ou arraste um v√≠deo aqui</span>
                                <span class="upload-info">MP4, WEBM, MOV, AVI - M√°x 500MB</span>
                                <span class="upload-warning">‚ö†Ô∏è Upload pode demorar alguns minutos</span>
                            </div>
                            <div class="file-preview" id="video-preview"></div>
                        </div>
                    </div>
                </div>
                
                <!-- URL de v√≠deo -->
                <div class="upload-method-video" id="video-url-method">
                    <div class="form-group">
                        <label>URL do V√≠deo (YouTube ou Vimeo)</label>
                        <input type="url" name="video_url" placeholder="https://youtube.com/watch?v=...">
                        <small>Cole o link do YouTube ou Vimeo com o depoimento</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>URL da Thumbnail (opcional)</label>
                    <input type="url" name="thumbnail" placeholder="https://...">
                    <small>Imagem de capa do v√≠deo (se n√£o informar, usa padr√£o do player)</small>
                </div>
                
                <button type="submit" class="btn btn-primary">Adicionar V√≠deo Depoimento</button>
                
                <div class="upload-tips">
                    <h4>üí° Dicas para V√≠deos:</h4>
                    <ul>
                        <li>V√≠deos curtos (30seg-2min) t√™m mais engajamento</li>
                        <li>Grave horizontal para melhor visualiza√ß√£o</li>
                        <li>Boa ilumina√ß√£o e √°udio claro s√£o essenciais</li>
                        <li>YouTube √© recomendado para v√≠deos mais longos</li>
                        <li>Upload local para v√≠deos curtos e controle total</li>
                    </ul>
                </div>
            </form>

            <h3 style="margin-top: 3rem;">V√≠deos Existentes</h3>
            {% if videos %}
            <div class="videos-admin-grid">
                {% for video in videos|reverse %}
                <div class="video-admin-item">
                    <div class="video-admin-thumbnail">
                        {% if video.uploaded %}
                            <video preload="metadata" style="width: 100%; height: 180px; object-fit: cover;">
                                <source src="{{ video.url }}">
                            </video>
                        {% else %}
                            {% if video.thumbnail %}
                                <img src="{{ video.thumbnail }}" alt="{{ video.title }}">
                            {% else %}
                                <div class="video-placeholder-admin">
                                    üé•<br>
                                    <small>V√≠deo Externo</small>
                                </div>
                            {% endif %}
                        {% endif %}
                    </div>
                    <div class="video-admin-info">
                        <div class="video-rating-small">{{ '‚òÖ' * video.rating }}</div>
                        <strong>{{ video.title }}</strong>
                        <small>{{ video.name }} - {{ video.date }}</small>
                        {% if video.get('uploaded', False) %}
                        <span class="badge-uploaded">üì§ Upload Local</span>
                        {% else %}
                        <span class="badge-external">üîó URL Externa</span>
                        {% endif %}
                    </div>
                    <form method="POST" action="{{ url_for('delete_video', video_id=video.id) }}" 
                          onsubmit="return confirm('Tem certeza que deseja deletar este v√≠deo?');"
                          class="delete-form">
                        <button type="submit" class="btn-delete">üóëÔ∏è Deletar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-message">Nenhum v√≠deo depoimento ainda.</p>
            {% endif %}
        </div>

        <!-- Gallery Tab -->
        <div class="tab-content" id="gallery">
            <h2>Adicionar √† Galeria</h2>
            <form method="POST" action="{{ url_for('add_gallery') }}" enctype="multipart/form-data" class="admin-form">
                <div class="form-row">
                    <div class="form-group">
                        <label>T√≠tulo</label>
                        <input type="text" name="title" required>
                    </div>
                    <div class="form-group">
                        <label>Tipo</label>
                        <select name="type" required>
                            <option value="image">Imagem</option>
                            <option value="video">V√≠deo</option>
                        </select>
                    </div>
                </div>
                
                <div class="upload-method-selector">
                    <div class="method-tabs">
                        <button type="button" class="method-tab active" data-method="upload">
                            üì§ Upload de Arquivo
                        </button>
                        <button type="button" class="method-tab" data-method="url">
                            üîó URL Externa
                        </button>
                    </div>
                </div>
                
                <!-- Upload de arquivo -->
                <div class="upload-method active" id="upload-method">
                    <div class="form-group">
                        <label>Fazer Upload da Imagem</label>
                        <div class="file-upload-area">
                            <input type="file" id="file-input" name="file" accept="image/*">
                            <div class="file-upload-label">
                                <span class="upload-icon">üì∑</span>
                                <span class="upload-text">Clique ou arraste uma imagem aqui</span>
                                <span class="upload-info">PNG, JPG, JPEG, GIF, WEBP - M√°x 16MB</span>
                            </div>
                            <div class="file-preview" id="file-preview"></div>
                        </div>
                    </div>
                </div>
                
                <!-- URL externa -->
                <div class="upload-method" id="url-method">
                    <div class="form-group">
                        <label>URL da Imagem/V√≠deo</label>
                        <input type="url" name="url" placeholder="https://exemplo.com/imagem.jpg">
                        <small>Use URLs de sites como Imgur, Unsplash, etc.</small>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Descri√ß√£o (opcional)</label>
                    <input type="text" name="description" placeholder="Breve descri√ß√£o da imagem">
                </div>
                <button type="submit" class="btn btn-primary">Adicionar √† Galeria</button>
            </form>

            <h3 style="margin-top: 3rem;">Itens na Galeria</h3>
            {% if gallery %}
            <div class="gallery-admin-grid">
                {% for item in gallery|reverse %}
                <div class="gallery-admin-item">
                    {% if item.type == 'image' %}
                    <img src="{{ item.url }}" alt="{{ item.title }}" loading="lazy">
                    {% else %}
                    <div class="video-placeholder">üé• V√≠deo</div>
                    {% endif %}
                    <div class="gallery-admin-info">
                        <strong>{{ item.title }}</strong>
                        <small>{{ item.description }}</small>
                        {% if item.get('uploaded', False) %}
                        <span class="badge-uploaded">üì§ Upload Local</span>
                        {% endif %}
                    </div>
                    <form method="POST" action="{{ url_for('delete_gallery', item_id=item.id) }}" 
                          onsubmit="return confirm('Tem certeza que deseja deletar esta imagem?');"
                          class="delete-form">
                        <button type="submit" class="btn-delete">üóëÔ∏è Deletar</button>
                    </form>
                </div>
                {% endfor %}
            </div>
            {% else %}
            <p class="empty-message">Nenhum item na galeria ainda.</p>
            {% endif %}
        </div>
    </div>
</section>

<style>
.admin-section {
    padding: 4rem 0;
    min-height: 60vh;
}

.admin-tabs {
    display: flex;
    gap: 1rem;
    margin-bottom: 3rem;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.tab-btn {
    font-family: var(--font-display);
    font-size: 1rem;
    font-weight: 700;
    padding: 1rem 2rem;
    background: transparent;
    border: none;
    color: var(--color-text-dim);
    cursor: pointer;
    letter-spacing: 1px;
    border-bottom: 3px solid transparent;
    transition: var(--transition-fast);
}

.tab-btn:hover {
    color: var(--color-white);
}

.tab-btn.active {
    color: var(--color-accent);
    border-bottom-color: var(--color-accent);
}

.tab-content {
    display: none;
}

.tab-content.active {
    display: block;
}

.tab-content h2 {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 900;
    margin-bottom: 2rem;
    letter-spacing: 1px;
}

.tab-content h3 {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 700;
    margin-bottom: 1.5rem;
    letter-spacing: 1px;
}

.admin-form {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 2rem;
    margin-bottom: 3rem;
}

.admin-form .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.admin-form .form-group {
    margin-bottom: 1.5rem;
}

.admin-form label {
    display: block;
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    letter-spacing: 1px;
}

.admin-form input,
.admin-form select,
.admin-form textarea {
    width: 100%;
    padding: 0.8rem;
    background: rgba(255, 255, 255, 0.05);
    border: 1px solid rgba(255, 255, 255, 0.2);
    border-radius: 8px;
    color: var(--color-white);
    font-family: var(--font-body);
    font-size: 1rem;
}

.admin-form input:focus,
.admin-form select:focus,
.admin-form textarea:focus {
    outline: none;
    border-color: var(--color-accent);
}

.table-container {
    overflow-x: auto;
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1rem;
}

.admin-table {
    width: 100%;
    border-collapse: collapse;
}

.admin-table th {
    font-family: var(--font-display);
    font-weight: 700;
    padding: 1rem;
    text-align: left;
    border-bottom: 2px solid rgba(255, 255, 255, 0.2);
    letter-spacing: 1px;
    font-size: 0.9rem;
}

.admin-table td {
    padding: 1rem;
    border-bottom: 1px solid rgba(255, 255, 255, 0.1);
    color: var(--color-text-dim);
}

.admin-table tbody tr:hover {
    background: rgba(255, 255, 255, 0.03);
}

.testimonials-list {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.testimonial-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    padding: 1.5rem;
}

.testimonial-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.8rem;
}

.testimonial-header strong {
    font-family: var(--font-display);
    font-size: 1.1rem;
}

.testimonial-header span {
    color: var(--color-star);
}

.testimonial-item p {
    color: var(--color-text-dim);
    margin-bottom: 0.5rem;
    font-style: italic;
}

.testimonial-item small {
    color: var(--color-text-dim);
    font-size: 0.85rem;
}

.gallery-admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
    gap: 1.5rem;
}

.gallery-admin-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 10px;
    overflow: hidden;
}

.gallery-admin-item img {
    width: 100%;
    height: 150px;
    object-fit: cover;
}

.video-placeholder {
    width: 100%;
    height: 150px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255, 255, 255, 0.05);
    font-size: 2rem;
}

.gallery-admin-info {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.3rem;
}

.gallery-admin-info strong {
    font-family: var(--font-display);
    font-size: 0.9rem;
}

.gallery-admin-info small {
    color: var(--color-text-dim);
    font-size: 0.85rem;
}

.empty-message {
    text-align: center;
    padding: 3rem;
    color: var(--color-text-dim);
    font-size: 1.1rem;
}

/* Upload de Arquivos */
.upload-method-selector {
    margin-bottom: 2rem;
}

.method-tabs {
    display: flex;
    gap: 1rem;
    border-bottom: 2px solid rgba(255, 255, 255, 0.1);
}

.method-tab {
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 700;
    padding: 1rem 2rem;
    background: transparent;
    border: none;
    color: var(--color-text-dim);
    cursor: pointer;
    letter-spacing: 1px;
    border-bottom: 3px solid transparent;
    transition: var(--transition-fast);
}

.method-tab:hover {
    color: var(--color-white);
}

.method-tab.active {
    color: var(--color-accent);
    border-bottom-color: var(--color-accent);
}

.upload-method {
    display: none;
}

.upload-method.active {
    display: block;
}

.file-upload-area {
    position: relative;
    margin-bottom: 1rem;
}

.file-upload-area input[type="file"] {
    position: absolute;
    width: 100%;
    height: 100%;
    opacity: 0;
    cursor: pointer;
    z-index: 2;
}

.file-upload-label {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 3rem 2rem;
    background: rgba(255, 255, 255, 0.03);
    border: 2px dashed rgba(0, 212, 255, 0.3);
    border-radius: 15px;
    transition: var(--transition-fast);
    cursor: pointer;
}

.file-upload-area:hover .file-upload-label {
    background: rgba(255, 255, 255, 0.05);
    border-color: rgba(0, 212, 255, 0.6);
}

.file-upload-area.dragging .file-upload-label {
    background: rgba(0, 212, 255, 0.1);
    border-color: var(--color-accent);
}

.upload-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
}

.upload-text {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--color-white);
}

.upload-info {
    font-size: 0.85rem;
    color: var(--color-text-dim);
}

.file-preview {
    display: none;
    margin-top: 1rem;
    padding: 1rem;
    background: rgba(255, 255, 255, 0.05);
    border-radius: 10px;
}

.file-preview.active {
    display: block;
}

.file-preview img {
    max-width: 100%;
    max-height: 300px;
    border-radius: 10px;
    margin-top: 0.5rem;
}

.file-preview-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.5rem;
}

.file-name {
    font-family: var(--font-display);
    font-weight: 700;
    color: var(--color-accent);
}

.file-size {
    font-size: 0.85rem;
    color: var(--color-text-dim);
}

.badge-uploaded {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: rgba(0, 212, 255, 0.2);
    border: 1px solid rgba(0, 212, 255, 0.4);
    border-radius: 20px;
    font-size: 0.75rem;
    font-family: var(--font-display);
    color: var(--color-accent);
    margin-top: 0.5rem;
}

.delete-form {
    margin-top: 0.5rem;
}

.btn-delete {
    width: 100%;
    padding: 0.5rem;
    background: rgba(255, 0, 0, 0.1);
    border: 1px solid rgba(255, 0, 0, 0.3);
    border-radius: 8px;
    color: #ff6b6b;
    font-family: var(--font-display);
    font-size: 0.85rem;
    cursor: pointer;
    transition: var(--transition-fast);
}

.btn-delete:hover {
    background: rgba(255, 0, 0, 0.2);
    border-color: rgba(255, 0, 0, 0.5);
}

/* V√≠deos Admin */
.upload-method-video {
    display: none;
}

.upload-method-video.active {
    display: block;
}

.method-tab-video {
    font-family: var(--font-display);
    font-size: 0.9rem;
    font-weight: 700;
    padding: 1rem 2rem;
    background: transparent;
    border: none;
    color: var(--color-text-dim);
    cursor: pointer;
    letter-spacing: 1px;
    border-bottom: 3px solid transparent;
    transition: var(--transition-fast);
}

.method-tab-video:hover {
    color: var(--color-white);
}

.method-tab-video.active {
    color: var(--color-accent-bright);
    border-bottom-color: var(--color-accent-bright);
}

.video-upload .upload-icon {
    font-size: 4rem;
}

.upload-warning {
    display: block;
    margin-top: 1rem;
    font-size: 0.85rem;
    color: #ffaa00;
    font-weight: bold;
}

.upload-tips {
    margin-top: 2rem;
    padding: 1.5rem;
    background: rgba(255, 215, 0, 0.05);
    border: 1px solid rgba(255, 215, 0, 0.2);
    border-radius: 10px;
}

.upload-tips h4 {
    font-family: var(--font-display);
    font-size: 1.1rem;
    margin-bottom: 1rem;
    color: var(--color-star);
}

.upload-tips ul {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.upload-tips li {
    padding-left: 1.5rem;
    position: relative;
    color: var(--color-text-dim);
    font-size: 0.95rem;
}

.upload-tips li::before {
    content: '‚úì';
    position: absolute;
    left: 0;
    color: var(--color-star);
}

.videos-admin-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 1.5rem;
}

.video-admin-item {
    background: rgba(255, 255, 255, 0.03);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 15px;
    overflow: hidden;
}

.video-admin-thumbnail {
    width: 100%;
    height: 180px;
    background: rgba(0, 0, 0, 0.3);
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
}

.video-admin-thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
}

.video-placeholder-admin {
    text-align: center;
    color: var(--color-text-dim);
    font-size: 2rem;
}

.video-placeholder-admin small {
    display: block;
    font-size: 0.8rem;
    margin-top: 0.5rem;
}

.video-admin-info {
    padding: 1rem;
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.video-rating-small {
    color: var(--color-star);
    font-size: 0.9rem;
}

.video-admin-info strong {
    font-family: var(--font-display);
    font-size: 1rem;
    color: var(--color-white);
}

.video-admin-info small {
    color: var(--color-text-dim);
    font-size: 0.85rem;
}

.badge-external {
    display: inline-block;
    padding: 0.25rem 0.75rem;
    background: rgba(124, 77, 255, 0.2);
    border: 1px solid rgba(124, 77, 255, 0.4);
    border-radius: 20px;
    font-size: 0.75rem;
    font-family: var(--font-display);
    color: var(--color-accent-bright);
    margin-top: 0.5rem;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const tabBtns = document.querySelectorAll('.tab-btn');
    const tabContents = document.querySelectorAll('.tab-content');
    
    tabBtns.forEach(btn => {
        btn.addEventListener('click', () => {
            const tabName = btn.dataset.tab;
            
            tabBtns.forEach(b => b.classList.remove('active'));
            tabContents.forEach(c => c.classList.remove('active'));
            
            btn.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        });
    });
    
    // Upload method tabs
    const methodTabs = document.querySelectorAll('.method-tab');
    const uploadMethods = document.querySelectorAll('.upload-method');
    
    methodTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const method = tab.dataset.method;
            
            methodTabs.forEach(t => t.classList.remove('active'));
            uploadMethods.forEach(m => m.classList.remove('active'));
            
            tab.classList.add('active');
            document.getElementById(`${method}-method`).classList.add('active');
            
            // Limpar campos do m√©todo n√£o selecionado
            if (method === 'upload') {
                document.querySelector('input[name="url"]').value = '';
                document.querySelector('input[name="url"]').removeAttribute('required');
                document.querySelector('input[name="file"]').setAttribute('required', 'required');
            } else {
                document.querySelector('input[name="file"]').value = '';
                document.querySelector('input[name="file"]').removeAttribute('required');
                document.querySelector('input[name="url"]').setAttribute('required', 'required');
            }
        });
    });
    
    // Video method tabs
    const videoMethodTabs = document.querySelectorAll('.method-tab-video');
    const videoUploadMethods = document.querySelectorAll('.upload-method-video');
    
    videoMethodTabs.forEach(tab => {
        tab.addEventListener('click', () => {
            const method = tab.dataset.method;
            
            videoMethodTabs.forEach(t => t.classList.remove('active'));
            videoUploadMethods.forEach(m => m.classList.remove('active'));
            
            tab.classList.add('active');
            document.getElementById(`${method}-method`).classList.add('active');
            
            // Limpar campos
            if (method === 'video-upload') {
                const urlInput = document.querySelector('input[name="video_url"]');
                if (urlInput) {
                    urlInput.value = '';
                    urlInput.removeAttribute('required');
                }
                const fileInput = document.querySelector('input[name="video_file"]');
                if (fileInput) {
                    fileInput.setAttribute('required', 'required');
                }
            } else {
                const fileInput = document.querySelector('input[name="video_file"]');
                if (fileInput) {
                    fileInput.value = '';
                    fileInput.removeAttribute('required');
                }
                const urlInput = document.querySelector('input[name="video_url"]');
                if (urlInput) {
                    urlInput.setAttribute('required', 'required');
                }
            }
        });
    });
    
    // File upload preview
    const fileInput = document.getElementById('file-input');
    const filePreview = document.getElementById('file-preview');
    const uploadArea = document.querySelector('.file-upload-area');
    
    if (fileInput) {
        fileInput.addEventListener('change', function(e) {
            handleFiles(this.files);
        });
        
        // Drag and drop
        uploadArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            this.classList.add('dragging');
        });
        
        uploadArea.addEventListener('dragleave', function(e) {
            e.preventDefault();
            this.classList.remove('dragging');
        });
        
        uploadArea.addEventListener('drop', function(e) {
            e.preventDefault();
            this.classList.remove('dragging');
            
            if (e.dataTransfer.files.length) {
                fileInput.files = e.dataTransfer.files;
                handleFiles(e.dataTransfer.files);
            }
        });
    }
    
    function handleFiles(files) {
        if (files.length === 0) return;
        
        const file = files[0];
        
        // Validar tipo de arquivo
        const allowedTypes = ['image/png', 'image/jpeg', 'image/jpg', 'image/gif', 'image/webp'];
        if (!allowedTypes.includes(file.type)) {
            alert('Tipo de arquivo n√£o permitido! Use PNG, JPG, JPEG, GIF ou WEBP.');
            fileInput.value = '';
            return;
        }
        
        // Validar tamanho (16MB)
        const maxSize = 16 * 1024 * 1024;
        if (file.size > maxSize) {
            alert('Arquivo muito grande! Tamanho m√°ximo: 16MB');
            fileInput.value = '';
            return;
        }
        
        // Mostrar preview
        filePreview.classList.add('active');
        
        const reader = new FileReader();
        reader.onload = function(e) {
            filePreview.innerHTML = `
                <div class="file-preview-info">
                    <span class="file-name">${file.name}</span>
                    <span class="file-size">${formatFileSize(file.size)}</span>
                </div>
                <img src="${e.target.result}" alt="Preview">
            `;
        };
        reader.readAsDataURL(file);
    }
    
    // Video file upload preview
    const videoFileInput = document.getElementById('video-file-input');
    const videoPreview = document.getElementById('video-preview');
    
    if (videoFileInput) {
        videoFileInput.addEventListener('change', function(e) {
            handleVideoFiles(this.files);
        });
    }
    
    function handleVideoFiles(files) {
        if (files.length === 0) return;
        
        const file = files[0];
        
        // Validar tipo de arquivo
        const allowedTypes = ['video/mp4', 'video/webm', 'video/quicktime', 'video/x-msvideo'];
        if (!allowedTypes.includes(file.type)) {
            alert('Tipo de v√≠deo n√£o permitido! Use MP4, WEBM, MOV ou AVI.');
            videoFileInput.value = '';
            return;
        }
        
        // Validar tamanho (500MB)
        const maxSize = 500 * 1024 * 1024;
        if (file.size > maxSize) {
            alert('V√≠deo muito grande! Tamanho m√°ximo: 500MB\nConsidere usar YouTube para v√≠deos maiores.');
            videoFileInput.value = '';
            return;
        }
        
        // Mostrar preview
        videoPreview.classList.add('active');
        videoPreview.innerHTML = `
            <div class="file-preview-info">
                <span class="file-name">üé• ${file.name}</span>
                <span class="file-size">${formatFileSize(file.size)}</span>
            </div>
            <p style="color: var(--color-text-dim); margin-top: 1rem;">
                ‚è≥ O upload pode demorar alguns minutos dependendo do tamanho do arquivo.
            </p>
        `;
    }
    
    function formatFileSize(bytes) {
        if (bytes === 0) return '0 Bytes';
        const k = 1024;
        const sizes = ['Bytes', 'KB', 'MB'];
        const i = Math.floor(Math.log(bytes) / Math.log(k));
        return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
    }
});
</script>
{% endblock %}
